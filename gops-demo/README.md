# دمو gops

این یک پروژه‌ی ساده به زبان Go است که نشان می‌دهد چگونه می‌توان از [gops](https://github.com/google/gops) برای مانیتور و دیباگ کردن برنامه‌های Go در زمان اجرا استفاده کرد.

## امکانات

- راه‌اندازی **gops agent** روی آدرس `127.0.0.1:9000` (فقط لوکال هاست).
- پاکسازی خودکار ساکت‌ها/فایل‌ها در هنگام خروج.
- اجرای یک کار ساختگی (`heavyWork`) برای فعال نگه داشتن CPU و حافظه.
- خروج امن با فشردن کلیدهای `Ctrl+C`.

## ساختار کد

- **main.go**:
  - راه‌اندازی agent با:
    ```go
    agent.Listen(agent.Options{
        Addr: "127.0.0.1:9000",
        ShutdownCleanup: true,
    })
    ```
  - استفاده از `time.Ticker` برای اجرای دوره‌ای `heavyWork()`.
  - مدیریت سیگنال‌های خروج با `signal.NotifyContext`.

- **heavyWork()**:
  - اجرای یک حلقه ساده (از 0 تا 100000) برای ایجاد کمی فشار CPU و حافظه تا بتوان با gops وضعیت را مشاهده کرد.

## نحوه اجرا

### 1. نصب gops

```bash
go install github.com/google/gops@latest
```

اطمینان حاصل کنید که مسیر `~/go/bin` یا محل نصب پیش‌فرض Go در PATH سیستم شما باشد.

### 2. اجرای برنامه

```bash
go run main.go
```

خروجی:
```
gops demo is running. Press Ctrl+C to exit.
```

### 3. بررسی با gops بدون نیاز به PID

چون در کد از آدرس ثابت `127.0.0.1:9000` استفاده شده است، می‌توانید بدون پیدا کردن PID مستقیماً به آن وصل شوید:

```bash
gops stats 127.0.0.1:9000
gops memstats 127.0.0.1:9000
gops stack 127.0.0.1:9000
gops trace 127.0.0.1:9000
```

### 4. بستن برنامه

برای خروج کافیست در ترمینال اجرای برنامه کلیدهای `Ctrl+C` را بزنید.  
پیام زیر چاپ می‌شود و منابع آزاد خواهند شد:

```
shutting down...
```

## نکات

- با این روش می‌توانید همزمان چند برنامه را اجرا کنید، کافیست پورت هرکدام متفاوت باشد (مثل `127.0.0.1:9001`).  
- `ShutdownCleanup` تضمین می‌کند که پس از بستن برنامه هیچ فایل ساکتی باقی نماند.
